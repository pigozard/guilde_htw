<% existing = event.participation_for(character) %>
<% default_spec = existing&.active_specialization || character.specialization %>

<div class="signup-row">
  <div class="signup-character">
    <% if character.wow_class.present? %>
      <%= image_tag "classes/#{character.wow_class.name.downcase.gsub(' ', '_')}.png", class: "class-icon" %>
    <% end %>
    <div class="signup-character-info">
      <strong><%= character.pseudo %></strong>
      <span class="signup-spec-info">
        <%= character.wow_class&.name %>
        <% if default_spec %>
          - <%= default_spec.name %>
        <% end %>
      </span>
    </div>
  </div>

  <div class="signup-actions">
    <% if existing %>
      <%= form_with url: event_event_participation_path(event, existing), method: :patch, local: true, class: "signup-form" do %>
        <input type="hidden" name="specialization_id" value="<%= default_spec&.id %>">

        <div class="status-buttons">
          <button type="submit" name="status" value="confirmed" class="btn-status btn-status-success <%= 'active' if existing.status == 'confirmed' %>" title="PrÃ©sent">âœ…</button>
          <button type="submit" name="status" value="tentative" class="btn-status btn-status-warning <%= 'active' if existing.status == 'tentative' %>" title="Incertain">â“</button>
          <button type="submit" name="status" value="declined" class="btn-status btn-status-danger <%= 'active' if existing.status == 'declined' %>" title="Absent">âŒ</button>
        </div>
      <% end %>

      <%= button_to event_event_participation_path(event, existing), method: :delete, class: "btn-remove" do %>
        ğŸ—‘ï¸ Retirer
      <% end %>

    <% else %>
      <%= form_with url: event_event_participations_path(event), method: :post, local: true, class: "signup-form" do %>
        <input type="hidden" name="character_id" value="<%= character.id %>">
        <input type="hidden" name="specialization_id" value="<%= default_spec&.id %>">

        <div class="status-buttons">
          <button type="submit" name="status" value="confirmed" class="btn-status btn-status-success" title="PrÃ©sent">âœ…</button>
          <button type="submit" name="status" value="tentative" class="btn-status btn-status-warning" title="Incertain">â“</button>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
