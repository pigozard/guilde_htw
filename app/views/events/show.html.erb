<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <!-- Header -->
      <div class="event-header mb-4">
        <span class="event-type-badge event-<%= @event.event_type.gsub('+', '-plus') %>">
          <%= @event.event_type_emoji %> <%= @event.event_type_label %>
        </span>
        <h1 class="mt-3 page-title"><%= @event.title %></h1>
        <p class="text-muted mb-1">ğŸ“… <%= @event.start_time.strftime("%A %d %B %Y Ã  %H:%M") %></p>
        <p class="text-muted mb-1">ğŸ‘¤ CrÃ©Ã© par <%= @event.user.email.split("@").first %></p>
        <% if @event.max_participants %>
          <p class="text-muted mb-1">ğŸ‘¥ <%= @event.confirmed_count %>/<%= @event.max_participants %> places</p>
        <% end %>

        <% if @event.description.present? %>
          <p class="mt-3"><%= @event.description %></p>
        <% end %>

        <% if user_signed_in? && @event.user == current_user %>
          <div class="mt-3">
            <%= link_to edit_event_path(@event), class: "btn btn-outline-light btn-sm" do %>
              âœï¸ Modifier
            <% end %>
            <%= button_to event_path(@event), method: :delete, class: "btn btn-outline-danger btn-sm", data: { confirm: "Supprimer ?" } do %>
              ğŸ—‘ï¸ Supprimer
            <% end %>
          </div>
        <% end %>
      </div>

    <!-- Composition -->
<% if @confirmed.any? %>
  <div class="card-htw mb-4">
    <div class="card-header">ğŸ“Š Composition</div>
    <div class="card-body">
      <div class="composition-grid">
        <% roles = @confirmed.map(&:role).compact.tally %>
        <div class="composition-box">
          <%= image_tag "roles/tank.png", class: "role-icon-big" %>
          <div class="count"><%= roles["tank"] || 0 %></div>
          <div class="label">Tanks</div>
        </div>
        <div class="composition-box">
          <%= image_tag "roles/healer.png", class: "role-icon-big" %>
          <div class="count"><%= roles["healer"] || 0 %></div>
          <div class="label">Heals</div>
        </div>
        <div class="composition-box">
          <%= image_tag "roles/dps_cac.png", class: "role-icon-big" %>
          <div class="count"><%= roles["dps_cac"] || 0 %></div>
          <div class="label">CAC</div>
        </div>
        <div class="composition-box">
          <%= image_tag "roles/dps_caster.png", class: "role-icon-big" %>
          <div class="count"><%= roles["dps_caster"] || 0 %></div>
          <div class="label">Casters</div>
        </div>
      </div>
    </div>
  </div>
<% end %>
      <!-- ConfirmÃ©s -->
      <div class="card-htw mb-3">
        <div class="card-header header-confirmed">âœ… ConfirmÃ©s (<%= @confirmed.count %>)</div>
        <div class="card-body">
          <% if @confirmed.any? %>
            <div class="row">
              <% @confirmed.each do |p| %>
                <div class="col-md-6">
                  <%= render "participant_card", p: p %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted mb-0">Personne pour l'instant</p>
          <% end %>
        </div>
      </div>

      <!-- Incertains -->
      <div class="card-htw mb-3">
        <div class="card-header header-tentative">â“ Incertains (<%= @tentative.count %>)</div>
        <div class="card-body">
          <% if @tentative.any? %>
            <div class="row">
              <% @tentative.each do |p| %>
                <div class="col-md-6">
                  <%= render "participant_card", p: p %>
                </div>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted mb-0">Personne</p>
          <% end %>
        </div>
      </div>

      <!-- Absents -->
      <% if @declined.any? %>
        <div class="card-htw mb-4">
          <div class="card-header header-declined">âŒ Absents (<%= @declined.count %>)</div>
          <div class="card-body">
            <div class="row">
              <% @declined.each do |p| %>
                <div class="col-md-6">
                  <%= render "participant_card", p: p %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Inscription -->
      <% if user_signed_in? && @my_characters.any? %>
        <div class="card-htw mb-4">
          <div class="card-header">ğŸ“ S'inscrire</div>
          <div class="card-body">
            <% @my_characters.each do |character| %>
              <%= render "signup_form", character: character, event: @event %>
            <% end %>
          </div>
        </div>
      <% elsif user_signed_in? %>
        <div class="alert-info-htw">
  <%= link_to "CrÃ©e un personnage", new_character_path %> pour t'inscrire.
</div>
      <% else %>
       <div class="alert-info-htw">
  <%= link_to "CrÃ©e un personnage", new_character_path %> pour t'inscrire.
</div>
      <% end %>

   <%= link_to events_path, class: "btn-outline-gold" do %>
  â¬…ï¸ Retour au calendrier
<% end %>

    </div>
  </div>
</div>
