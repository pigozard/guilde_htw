<!-- Breadcrumb -->
<div class="hw-breadcrumb">
  <% breadcrumb_items.each_with_index do |item, index| %>
    <% if item[:active] %>
      <span class="hw-breadcrumb-active"><%= item[:label] %></span>
    <% else %>
      <span class="hw-breadcrumb-item">
        <%= link_to item[:label], item[:url] %>
      </span>
      <span class="hw-breadcrumb-separator">â€º</span>
    <% end %>
  <% end %>
</div>

<!-- Titre et stats summary -->
<div class="hw-card">
  <div class="hw-card-header">
    <h2 class="hw-card-title"><%= title %></h2>
  </div>
  <div class="hw-card-body">
    <div class="hw-achievement-summary">
      <div class="hw-achievement-summary-box">
        <div class="hw-achievement-summary-number"><%= current_stats[:completed] %></div>
        <div class="hw-achievement-summary-label">âœ… ComplÃ©tÃ©s</div>
      </div>
      <div class="hw-achievement-summary-box">
        <div class="hw-achievement-summary-number"><%= current_stats[:remaining] %></div>
        <div class="hw-achievement-summary-label">âŒ Manquants</div>
      </div>
      <div class="hw-achievement-summary-box">
        <div class="hw-achievement-summary-number"><%= current_stats[:percentage] %>%</div>
        <div class="hw-achievement-summary-label">Progression</div>
      </div>
      <div class="hw-achievement-summary-box">
        <div class="hw-achievement-summary-number"><%= current_stats[:total] %></div>
        <div class="hw-achievement-summary-label">Total</div>
      </div>
    </div>
  </div>
</div>

<!-- Filtres catÃ©gories -->
<% if categories_with_stats.present? %>
  <div class="hw-achievement-categories">
    <%= link_to achievements_path(base_url_params),
        class: "hw-achievement-category-tab #{'active' unless params[:category_name].present?}" do %>
      Toutes
      <span class="hw-achievement-category-count">(<%= current_stats[:total] %>)</span>
    <% end %>

    <% categories_with_stats.each do |cat_stat| %>
      <% category_name = cat_stat[:category].is_a?(String) ? cat_stat[:category] : cat_stat[:category].name %>
      <%= link_to achievements_path(base_url_params.merge(category_name: category_name)),
          class: "hw-achievement-category-tab #{'active' if params[:category_name] == category_name}" do %>
        <%= category_name %>
        <span class="hw-achievement-category-count">
          (<%= cat_stat[:completed] %>/<%= cat_stat[:total] %>)
        </span>
      <% end %>
    <% end %>
  </div>
<% end %>

<!-- Toggle complÃ©tÃ©s/manquants -->
<div class="hw-card-actions" style="margin-bottom: 24px;">
  <% if @show_completed %>
    <%= link_to achievements_path(base_url_params.merge(show_completed: false, category_id: params[:category_id])),
        class: "hw-btn hw-btn-secondary" do %>
      âŒ Voir uniquement les manquants
    <% end %>
  <% else %>
    <%= link_to achievements_path(base_url_params.merge(show_completed: true, category_id: params[:category_id])),
        class: "hw-btn hw-btn-primary" do %>
      ğŸ“‹ Voir tous les hauts faits
    <% end %>
  <% end %>
</div>

<!-- Liste des achievements -->
<% if achievements.any? %>
  <div class="hw-card">
    <div class="hw-card-header">
      <span class="hw-card-icon">
        <% if @show_completed %>ğŸ“‹<% else %>âŒ<% end %>
      </span>
      <h2 class="hw-card-title">
        <% if @show_completed %>
          Tous les hauts faits (<%= achievements.count %>)
        <% else %>
          Hauts faits manquants (<%= achievements.count %>)
        <% end %>
      </h2>
    </div>
    <div class="hw-card-body" style="padding: 0;">
      <div class="hw-achievement-list" style="max-height: 700px; overflow-y: auto; padding: 20px;">
        <% achievements.each do |achievement| %>
          <% is_completed = @synced_achievements.include?(achievement.blizzard_id) %>

          <div class="hw-achievement-item <%= 'completed' if is_completed %>">
            <% if achievement.icon.present? %>
              <img src="<%= achievement.icon_url %>"
                   alt="<%= achievement.name %>"
                   class="hw-achievement-icon"
                   style="border-color: <%= is_completed ? '#81c784' : '#e57373' %>;">
            <% else %>
              <div class="hw-achievement-icon" style="background: #333;"></div>
            <% end %>

            <div class="hw-achievement-content">
              <div class="hw-achievement-name">
                <%= achievement.name %>
                <% if achievement.points > 0 %>
                  <span class="hw-achievement-points"><%= achievement.points %> pts</span>
                <% end %>
              </div>
              <% if achievement.description.present? %>
                <div class="hw-achievement-description">
                  <%= achievement.description %>
                </div>
              <% end %>
              <% if achievement.category.present? %>
                <div class="hw-achievement-description">
                  ğŸ“‚ <%= achievement.category %>
                </div>
              <% end %>
            </div>

            <div class="hw-achievement-status">
              <% if is_completed %>
                <span class="hw-achievement-status-completed">âœ…</span>
              <% else %>
                <span class="hw-achievement-status-incomplete">âŒ</span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <div class="hw-card" style="background: rgba(76, 175, 80, 0.1); border-color: rgba(76, 175, 80, 0.3);">
    <div class="hw-card-body" style="text-align: center; padding: 48px;">
      <h3 style="font-family: 'Cinzel', serif; color: #81c784; font-size: 24px; margin-bottom: 12px;">
        ğŸ‰ FÃ©licitations !
      </h3>
      <p style="color: #aaa; margin: 0;">
        <% if @selected_category.present? %>
          Vous avez terminÃ© tous les hauts faits de la catÃ©gorie "<%= @selected_category %>" !
        <% else %>
          Vous avez terminÃ© tous les hauts faits de cette section !
        <% end %>
      </p>
    </div>
  </div>
<% end %>

<!-- Bouton retour -->
<div class="hw-card-actions" style="margin-top: 24px;">
  <%= link_to back_url, class: "hw-btn hw-btn-secondary" do %>
    â† Retour Ã  la vue d'ensemble
  <% end %>
</div>
